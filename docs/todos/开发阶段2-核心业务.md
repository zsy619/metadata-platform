# 开发阶段2：核心业务

> **项目**: 元数据管理平台**技术栈**:
>
> - 前端: Vue3 + TypeScript + Element Plus + Vite
> - 后端: Golang + Hertz + GORM + MySQL/PostgreSQL
>   **最后更新**: 2026-01-24

---

## 前端开发任务

### 数据源管理

- [x] 数据源列表页（views/metadata/datasource/List.vue）
  - [x] 列表展示（表格）
  - [x] 分页
  - [x] 搜索（关键字）
  - [x] 筛选（类型）
  - [x] 操作按钮（新建/编辑/删除/测试连接）
  - [x] 连接状态显示
  - [x] 批量操作
- [x] 数据源表单对话框（components/DataSourceForm.vue）
  - [x] 表单字段（名称/类型/主机/端口/用户名/密码/数据库）
  - [x] 表单验证（必填/格式）
  - [x] 连接测试按钮
  - [x] 测试成功自动填充
  - [x] 密码显示/隐藏
  - [x] 保存/取消
- [x] 数据库对象浏览器（components/ObjectBrowser.vue）
  - [x] 树形结构（数据源/Schema/表/视图）
  - [x] 懒加载
  - [x] 搜索功能
  - [x] 刷新功能
  - [ ] 右键菜单（预览/构建模型）
- [x] 数据预览对话框（components/DataPreview.vue）
  - [x] 表格展示
  - [x] 分页
  - [x] 列信息显示

### 模型管理⭐⭐⭐

- [x] 模型列表页（views/model/List.vue）
  - [x] 列表展示
  - [x] 分页+搜索
  - [x] 筛选（按数据源/类型/状态）
  - [x] 操作（新建/从表构建/编辑/删除/克隆）
  - [x] 模型状态显示（锁定/公开）
  - [x] 批量操作
- [x] 模型构建向导（views/model/VisualCreate.vue）
  - [x] 步骤器（可视化画布+6步配置）
  - [x] 向导流程控制
  - [x] 数据验证
  - [x] 进度保存（可选）
- [x] 步骤1：数据源选择器（components/BaseInfoPanel.vue）
  - [x] 数据源列表
  - [x] 连接状态显示
  - [x] 测试连接
- [x] 步骤2：表/视图选择器（components/TableSelectDialog.vue）
  - [x] 标签页切换（表/视图）
  - [x] 表列表展示
  - [x] 搜索功能
  - [x] 预览表结构按钮
  - [x] 预览表数据按钮
  - [x] 记录数显示
- [x] 步骤3：字段配置器（components/FieldConfigPanel.vue）
  - [x] 字段列表表格
  - [x] 全选/全不选
  - [x] 字段选择（checkbox）
  - [x] 字段属性编辑（显示名称/字段代码/数据类型/长度/必填/主键/默认值）
  - [x] 添加自定义字段
  - [x] 删除自定义字段
  - [x] 字段拖拽排序
- [x] 步骤4：验证规则配置器（views/model/components/ValidationConfigurator.vue）
  - [x] 为每个字段配置验证规则
  - [x] 验证类型选择（必填/长度/范围/格式/自定义）
  - [x] 验证规则模板（邮箱/手机号/身份证/URL）
  - [x] 错误提示信息配置
  - [x] 验证规则测试
- [x] 步骤5：显示配置器（views/model/components/DisplayConfigurator.vue）
  - [x] 显示名称配置
  - [x] 显示顺序调整（拖拽）
  - [x] 显示宽度配置
  - [x] 组件类型选择（input/select/textarea/date-picker/upload等）
  - [x] 组件选项配置（下拉选项/上传限制等）
  - [x] 占位符/帮助文本
  - [x] 可搜索/可排序/可筛选配置
- [x] 步骤6：配置预览（views/model/components/BuildPreview.vue）
  - [x] 模型信息摘要
  - [x] 字段列表预览
  - [x] 验证规则预览
  - [x] 显示配置预览
  - [x] 确认创建按钮

### 接口管理

- [x] 接口列表页（views/api/List.vue）
  - [x] 列表展示
  - [x] 筛选（按模型/方法/状态）
  - [x] 操作（批量生成/新建/编辑/删除/测试）
  - [x] 启用/禁用开关
  - [x] 接口路径显示
  - [x] 请求方法标签（GET/POST/PUT/DELETE）
- [x] 批量生成对话框（components/api/BatchGenerateDialog.vue）
  - [x] 模型选择（下拉+搜索）
  - [x] 接口类型选择（Create/Read/Update/Delete/List）
  - [x] 路径前缀配置
  - [x] 接口预览列表
  - [x] 冲突检测提示
  - [x] 确认生成
- [x] 接口编辑页面（views/api/Create.vue / Edit.vue）
  - [x] 基本信息（名称/编码/路径/方法/关联模型/描述）
  - [ ] 路径参数配置
  - [ ] 查询参数配置
  - [ ] 请求体配置
  - [ ] 响应配置
  - [x] 保存/取消
- [x] 接口测试工具（components/api/APITester.vue）
  - [x] 请求构造器（自动填充参数）
  - [x] 参数输入（路径/查询/body）
  - [x] 发送请求按钮
  - [x] 请求信息显示（URL/Method/Headers/Body）
  - [x] 响应展示（JSON格式化+状态码+响应时间）
  - [x] 历史记录（保存+快速复用）
  - [x] 错误提示

### 查询模板管理⭐⭐

- [x] 查询模板编辑器（views/query-template/Editor.vue）
  - [x] 模板基本信息（名称/编码/描述）
  - [x] 集成条件构建器
  - [x] 条件配置
  - [x] SQL预览
  - [x] 结果预览（执行查询+表格展示）
  - [x] 保存/测试/取消
- [x] 可视化条件构建器（components/query/QueryBuilder.vue）
  - [x] 条件行组件
  - [x] 字段选择下拉（显示字段类型）
  - [x] 操作符选择（根据字段类型显示可用操作符）
  - [x] 值输入组件（文本/数字/日期/下拉/多选/范围）
  - [x] 逻辑运算符选择（AND/OR）
  - [x] 添加/删除条件按钮
  - [x] 条件组支持（括号）
  - [x] 添加条件组
  - [x] 嵌套条件支持
- [x] SQL预览组件（components/query/SQLPreview.vue）
  - [x] 显示生成的SQL
  - [x] 语法高亮
  - [x] 复制按钮
  - [x] 格式化按钮

### 数据查询界面

- [x] 数据列表页（views/data/List.vue）
  - [x] 动态表格（根据模型字段生成列）
  - [x] 高级筛选器（快速筛选/自定义筛选/模板筛选）
  - [x] 字段选择器（勾选显示字段+调整顺序+固定列）
  - [x] 分页
  - [x] 排序
  - [x] 操作列（查看/编辑/删除）
  - [x] 批量操作
  - [x] 导出按钮
- [x] 数据详情页（views/data/Detail.vue）
  - [x] 字段值展示
  - [x] 格式化显示
  - [x] 编辑按钮
  - [x] 返回列表
- [x] 数据表单对话框（components/data/DataForm.vue）
  - [x] 动态表单（根据模型字段配置生成）
  - [x] 组件类型渲染（input/select/date-picker等）
  - [x] 表单验证（应用验证规则）
  - [x] 默认值填充
  - [x] 必填标识
  - [x] 帮助文本显示
  - [x] 保存/取消

---

## 后端开发任务

### SQL生成引擎⭐⭐⭐

- [x] SQLBuilder架构
  - [x] 创建SQLBuilder主类
  - [x] 定义ModelData结构体（聚合所有模型数据）
  - [x] loadModelData方法（加载模型+表+字段+JOIN+WHERE+GROUP等）
- [x] SELECT子句构建器
  - [x] buildSelectClause方法
  - [x] buildFieldExpression方法（字段+表名前缀）
  - [x] 支持字段函数（UPPER/LOWER/DATE_FORMAT/SUBSTRING等）
  - [x] 支持聚合函数（SUM/COUNT/AVG/MAX/MIN）
  - [x] 支持字段别名（show_title）
- [x] FROM子句构建器
  - [x] buildFromClause方法
  - [x] 识别主表（is_main标记）
  - [x] 支持schema.table格式
- [x] JOIN子句构建器
  - [x] buildJoinClause方法
  - [x] buildJoinTree方法（支持嵌套JOIN，parent_id树形结构）
  - [x] generateJoinSQL方法（递归生成）
  - [x] buildJoinConditions方法（ON条件+括号+AND/OR）
  - [x] 支持LEFT/RIGHT/INNER/FULL OUTER JOIN
  - [x] 支持字段与字段比较
  - [x] 支持字段与值比较
  - [x] 支持JOIN字段函数
- [x] WHERE子句构建器
  - [x] buildWhereClause方法
  - [x] buildSingleCondition方法
  - [x] 支持所有运算符（=/!=/>/</>=/<=/LIKE/IN/BETWEEN/IS NULL/IS NOT NULL）
  - [x] 支持复杂条件（括号+AND/OR组合）
  - [x] 支持字段与字段比较
  - [x] 支持字段与值比较
  - [x] 参数化查询（防SQL注入）
  - [x] 支持字段函数
  - [x] 支持动态参数替换
- [x] GROUP BY和HAVING子句构建器
  - [x] buildGroupByClause方法
  - [x] buildHavingClause方法
  - [x] 支持分组字段函数
  - [x] 支持HAVING聚合条件（类似WHERE逻辑）
- [x] ORDER BY和LIMIT子句构建器
  - [x] buildOrderByClause方法（多字段+ASC/DESC）
  - [x] buildLimitClause方法（LIMIT+OFFSET）
  - [x] 支持动态分页参数
- [x] SQL组装与执行
  - [x] buildFromMetadata方法（组装完整SQL）
  - [x] buildFromSQL方法（处理原始SQL类型）
  - [x] SQL语法验证
  - [x] SQL注入检测

### SQL执行器

- [x] SQLExecutor类
  - [x] Execute方法（执行模型查询+动态参数）
  - [x] ExecuteCount方法（统计总数）
  - [x] parseRows方法（结果解析为map切片）
  - [x] SQL日志记录
  - [x] 执行时间监控
  - [x] 慢查询告警
- [x] 数据源连接管理
  - [x] GetConnection方法（根据conn_id获取连接）
  - [x] 连接池复用
  - [x] 连接健康检查

### 字段增强配置

- [x] FieldEnhancement Model（需新建表md_model_field_enhancements）
  - [x] display_name（显示名称）
  - [x] display_order（显示顺序）
  - [x] display_width（显示宽度）
  - [x] is_searchable/is_sortable/is_filterable（查询配置）
  - [x] placeholder/help_text（提示信息）
  - [x] component_type（组件类型：input/select/date-picker等）
  - [x] component_config（JSON组件配置：选项/限制等）
- [x] FieldEnhancement Service
  - [x] UpdateEnhancements方法（单个更新）
  - [x] BatchUpdateEnhancements方法（批量更新）
  - [x] GetEnhancements方法（按模型ID查询）
- [x] FieldEnhancement API
  - [x] GET /api/models/{id}/fields/enhancements
  - [x] PUT /api/models/{id}/fields/enhancements
  - [x] POST /api/models/{id}/fields/batch-enhancements

### CRUD接口自动生成

- [x] API Model（基于现有表）
- [x] APIParam Model
- [x] API Generator Service
  - [x] BatchGenerate方法（批量生成CRUD接口配置）
  - [x] 生成Create/Read/Update/Delete/List接口
  - [x] 生成接口路径（/api/data/{model_code}）
  - [x] 生成参数配置
  - [x] 路径冲突检测
- [x] Dynamic Router
  - [x] RegisterAPI方法（动态注册路由）
  - [x] handleCreate/handleGet/handleUpdate/handleDelete/handleList
  - [x] 路由参数绑定
  - [x] 请求验证
- [x] CRUD Service
  - [x] Create方法（验证+默认值+插入+返回ID）
  - [x] Get方法（按ID查询）
  - [x] Update方法（验证+更新）
  - [x] Delete方法（软删除）
  - [x] List方法（分页+排序+筛选+应用查询模板）
  - [x] BatchCreate/BatchUpdate/BatchDelete
  - [x] 数据验证器（基于字段配置）
  - [x] 默认值应用
- [x] API Management API
  - [x] GET /api/apis（接口列表）
  - [x] POST /api/apis/batch-generate（批量生成）
  - [x] PUT /api/apis/{id}（更新配置）
  - [x] DELETE /api/apis/{id}（删除）
  - [x] POST /api/apis/{id}/enable（启用/禁用）
  - [x] POST /api/apis/{id}/test（测试接口）

### 查询模板管理

- [x] QueryTemplate Model（基于md_model相关表）
- [x] QueryCondition Model
- [x] QueryTemplate Service
  - [x] Create/Get/Update/Delete方法
  - [x] SetDefault方法（设置默认模板）
  - [x] ApplyTemplate方法（应用模板到查询）
  - [x] Duplicate方法（复制模板）
- [x] QueryTemplate API
  - [x] GET /api/models/{id}/query-templates
  - [x] POST /api/models/{id}/query-templates
  - [x] GET /api/query-templates/{id}
  - [x] PUT /api/query-templates/{id}
  - [x] DELETE /api/query-templates/{id}
  - [x] POST /api/query-templates/{id}/set-default
  - [x] POST /api/query-templates/{id}/duplicate
  - [x] GET /api/query-templates/{id}/preview（预览SQL+结果）

### 数据查询API

- [x] POST /api/data/{model}/query（通用查询接口）
- [x] GET /api/data/{model}（列表查询+查询模板）
- [x] GET /api/data/{model}/{id}（详情查询）
- [x] POST /api/data/{model}（创建数据）
- [x] PUT /api/data/{model}/{id}（更新数据）
- [x] DELETE /api/data/{model}/{id}（删除数据）
- [x] POST /api/data/{model}/batch-create（批量创建）
- [x] PUT /api/data/{model}/batch-update（批量更新）
- [x] DELETE /api/data/{model}/batch-delete（批量删除）
- [x] GET /api/data/{model}/statistics（数据统计）
- [x] POST /api/data/{model}/aggregate（聚合查询）

---

## 测试用例

### 后端测试用例

- [x] SQL生成引擎测试（sql_builder_test.go, sql_builder_full_test.go）
- [x] SQL执行器测试（sql_executor相关）
- [x] 查询模板服务测试（query_template_test.go）
- [x] 字段增强配置测试（field_enhancement_test.go）
- [x] CRUD服务测试（crud_service_full_test.go）
- [x] API生成器测试（api_generator_test.go）

---

## 验收标准

### 前端验收

- 模型构建向导流程完整
- 接口管理功能可用
- 查询模板编辑器易用
- 数据查询界面功能完整

### 后端验收

- SQL生成引擎可生成复杂SQL
- 可批量生成CRUD接口
- 动态路由正常工作
- 查询模板功能完整

### 集成验收

- 模型构建功能正常
- 接口生成和调用正常
- 查询模板应用正常
- 数据查询功能完整
