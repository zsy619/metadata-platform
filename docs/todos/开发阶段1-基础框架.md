# 开发阶段1：基础框架

> **项目**: 元数据管理平台  
> **技术栈**: 
> - 前端: Vue3 + TypeScript + Element Plus + Vite  
> - 后端: Golang + Hertz + GORM + MySQL/PostgreSQL  
> **最后更新**: 2026-01-24

---

## 前端开发任务

### 项目初始化
- [x] 创建Vue3+TypeScript项目（Vite）
- [x] 安装依赖（vue-router@4 + pinia + element-plus + axios + sass）
- [x] 配置tsconfig.json
- [x] 配置vite.config.ts（路径别名@+代理+打包优化）
- [x] 配置环境变量（.env.development/.env.production）
- [x] 配置ESLint和Prettier
- [x] 创建目录结构（api/assets/components/layouts/router/stores/types/utils/views）

### 工具类封装
- [x] Axios封装（request.ts）
  - [x] 创建axios实例（baseURL+timeout）
  - [x] 请求拦截器（添加Token+Content-Type+Request-ID）
  - [x] 响应拦截器（错误处理+Token过期自动刷新+响应解包）
  - [ ] 请求重试机制 (Optional)
  - [ ] 请求取消机制 (Optional)
  - [x] 错误统一处理（网络错误/业务错误/系统错误）
- [x] 本地存储封装（storage.ts）
  - [x] Storage类（支持localStorage/sessionStorage）
  - [x] 过期时间支持
  - [x] 自动JSON序列化
- [x] 工具函数库
  - [x] 日期格式化（format.ts）
  - [x] 数字格式化（千分位/百分比/金额）
  - [x] 表单验证函数（validate.ts：邮箱/手机号/身份证/URL）
  - [x] 文件处理（utils/file.ts：大小格式化/类型判断）

### 路由配置
- [x] 路由定义（routes.ts）
  - [x] 登录页路由
  - [x] 首页仪表盘
  - [x] 数据源管理路由
  - [x] 模型管理路由
  - [x] 接口管理路由
  - [x] 404路由
- [x] 路由守卫（guards.ts）
  - [x] 前置守卫（登录验证+权限验证+用户信息加载）
  - [x] 后置守卫（NProgress+页面标题）
  - [x] 错误处理
- [x] 路由懒加载配置
- [ ] 路由缓存配置（keep-alive）

### 状态管理（Pinia）
- [x] useUserStore（user.ts）
  - [x] 状态：token/refreshToken/userInfo
  - [x] Getters：isLoggedIn/userName/userRoles
  - [x] Actions：login/logout/getUserInfo/refreshToken
  - [x] 状态持久化（localStorage）
- [x] useAppStore（app.ts）
  - [x] 状态：菜单折叠/主题配置/面包屑
  - [x] Actions：toggleSidebar/setTheme/setBreadcrumb
- [x] usePermissionStore（permission.ts，可选）
  - [x] 动态路由管理
  - [x] 权限验证

### 布局组件
- [x] DefaultLayout（layouts/DefaultLayout.vue）
  - [ ] 顶部导航栏（用户信息+退出+主题切换）
  - [ ] 侧边菜单（多级菜单+折叠）
  - [ ] 主内容区（router-view+keep-alive）
  - [ ] 面包屑导航
  - [ ] 响应式适配
- [ ] Sidebar组件（layouts/components/Sidebar.vue）
  - [ ] 菜单渲染（递归组件）
  - [ ] 菜单高亮
  - [ ] 菜单展开/折叠
  - [ ] 图标显示
- [ ] AppHeader组件（layouts/components/AppHeader.vue）
  - [ ] Logo+系统名称
  - [ ] 用户下拉菜单
  - [ ] 全屏按钮
  - [ ] 主题切换
- [ ] Breadcrumb组件（layouts/components/Breadcrumb.vue）
  - [ ] 自动生成面包屑
  - [ ] 点击跳转
- [ ] AuthLayout（登录页布局）

### 公共组件
- [ ] DataTable组件（components/table/DataTable.vue）
  - [ ] props配置化（columns/data/loading/pagination）
  - [ ] 分页支持
  - [ ] 排序支持
  - [ ] 筛选支持
  - [ ] 操作列插槽
  - [ ] 空数据提示
  - [ ] 加载状态
  - [ ] 刷新功能
- [ ] DynamicForm组件（components/form/DynamicForm.vue）
  - [ ] JSON配置驱动
  - [ ] 支持各种输入类型（input/select/date-picker/upload等）
  - [ ] 表单验证
  - [ ] 重置功能
  - [ ] 只读/禁用模式
- [ ] BaseDialog组件（components/dialog/BaseDialog.vue）
  - [ ] 统一样式
  - [ ] 多种尺寸
  - [ ] 确认/取消按钮
  - [ ] Loading状态
- [x] PageContainer组件（components/common/PageContainer.vue）
  - [x] 页面头部（标题+操作按钮）
  - [x] 内容区
  - [x] 统一间距
- [ ] EmptyState组件（components/common/EmptyState.vue）
  - [ ] 图标+文字
  - [ ] 操作按钮
- [ ] Loading组件（全局Loading/局部Loading/骨架屏）
- [x] SvgIcon组件（components/icon/SvgIcon.vue）

### API接口定义
- [x] Auth API（api/auth/index.ts）
  - [x] login/logout/getProfile/refresh/changePassword
- [ ] DataSource API（api/datasource/index.ts）
  - [ ] getList/create/update/delete/testConnection
  - [ ] getTables/getViews/getTableStructure/previewData
- [ ] Model API（api/model/index.ts）
  - [ ] getList/create/update/delete
  - [ ] buildFromTable/buildFromView
  - [ ] getFields/addField/updateField/deleteField
- [ ] API Management API（api/api/index.ts）
  - [ ] getList/batchGenerate/update/delete/enable
- [ ] QueryTemplate API（api/query-template/index.ts）
  - [ ] getList/create/update/delete/setDefault
- [x] TypeScript类型定义（types/*.ts）
  - [x] User/UserInfo/LoginParams
  - [x] DataSource/DataSourceForm (partially in data-source.ts)
  - [x] Model/ModelField/BuildModelParams (partially in model.ts)
  - [ ] API/APIParam
  - [ ] QueryTemplate/QueryCondition

### 基础页面
- [x] Login页面（views/auth/Login.vue）
  - [x] 登录表单（用户名+密码）
  - [x] 表单验证
  - [x] 记住密码
  - [x] 调用登录API
  - [x] 保存Token
  - [x] 跳转首页
  - [x] 错误提示
  - [x] Loading状态
- [x] Dashboard页面（views/home/Dashboard.vue）
  - [x] 统计卡片（数据源数/模型数/接口数/用户数）
  - [x] 图表展示（可选）
  - [x] 快捷操作
- [x] 404页面（views/error/404.vue）
  - [x] 友好提示
  - [x] 返回首页按钮

---

## 后端开发任务

### 项目初始化
- [x] 创建项目目录结构（Clean Architecture）
- [x] 配置管理模块（Viper，支持YAML/JSON/环境变量）
- [x] 日志系统（Zap + Lumberjack，多级别+轮转）
- [x] 数据库连接池（MySQL/PostgreSQL，健康检查）
- [x] 雪花算法ID生成器（并发安全，性能>100k/s）
- [x] 数据库迁移脚本（用户管理+元数据模块11张表）

### Web框架
- [ ] Hertz服务器初始化（优雅关闭）
- [x] 统一响应封装（Response/PageResponse/TraceID）
- [ ] 全局异常处理中间件（panic捕获+日志）
- [ ] CORS中间件（跨域配置）
- [ ] 请求日志中间件（记录请求/响应）

### 数据源管理模块（对应md_conn/md_table/md_table_field）
- [ ] DataSource Model定义（密码加密BeforeCreate/BeforeUpdate钩子）
- [ ] DataSource Repository（CRUD+分页+搜索+软删除）
- [ ] DataSource Service（连接测试+密码加密处理）
- [ ] 数据库驱动适配器
  - [ ] 定义MetadataExtractor接口
  - [ ] MySQLExtractor实现（GetTables/GetViews/GetColumns/GetTableStructure）
  - [ ] PostgreSQLExtractor实现
  - [ ] 连接池管理器（动态创建+缓存+关闭）
- [ ] DataSource API Handler
  - [ ] POST /api/data-sources（创建）
  - [ ] GET /api/data-sources（列表+分页+搜索）
  - [ ] GET /api/data-sources/{id}（详情，密码脱敏）
  - [ ] PUT /api/data-sources/{id}（更新）
  - [ ] DELETE /api/data-sources/{id}（软删除+检查依赖）
  - [ ] POST /api/data-sources/{id}/test（连接测试）
  - [ ] GET /api/data-sources/{id}/tables（获取表列表）
  - [ ] GET /api/data-sources/{id}/views（获取视图列表）
  - [ ] GET /api/data-sources/{id}/tables/{table}/structure（表结构）
  - [ ] GET /api/data-sources/{id}/tables/{table}/preview（数据预览）

### 模型管理模块（对应md_model/md_model_field/md_model_table等）
- [ ] Model定义（md_model，支持model_kind：1SQL/2视图表/3存储过程/4关联）
- [ ] ModelField定义（md_model_field，字段配置+函数+聚合）
- [ ] ModelTable定义（md_model_table，主表标记）
- [ ] ModelJoin定义（md_model_join，JOIN配置+树形结构）
- [ ] ModelWhere定义（md_model_where，WHERE条件+括号+逻辑运算）
- [ ] ModelGroup定义（md_model_group，GROUP BY）
- [ ] ModelHaving定义（md_model_having，HAVING条件）
- [ ] ModelOrder定义（md_model_order，ORDER BY+ASC/DESC）
- [ ] ModelLimit定义（md_model_limit，分页）
- [ ] ModelSQL定义（md_model_sql，原始SQL）
- [ ] Model Repository（CRUD+级联查询+版本管理）
- [ ] Model Service
  - [ ] Create/Get/Update/Delete/List方法
  - [ ] BuildFromTable方法（从表构建模型+字段映射）
  - [ ] BuildFromView方法（从视图构建+只读标记）
  - [ ] 字段数据类型映射（MySQL/PostgreSQL类型映射表）
  - [ ] 验证规则自动生成（基于NOT NULL/长度/类型）
  - [ ] 默认值处理（固定值+动态值CURRENT_TIMESTAMP）
  - [ ] 模型配置验证（唯一性+主键+类型）
- [ ] Model API Handler
  - [ ] POST /api/models（创建）
  - [ ] GET /api/models（列表+分页+按数据源筛选）
  - [ ] GET /api/models/{id}（详情+包含字段）
  - [ ] PUT /api/models/{id}（更新）
  - [ ] DELETE /api/models/{id}（软删除+检查依赖）
  - [ ] POST /api/models/build-from-table（从表构建）
  - [ ] POST /api/models/build-from-view（从视图构建）
  - [ ] GET /api/models/{id}/fields（字段列表）
  - [ ] POST /api/models/{id}/fields（添加字段）
  - [ ] PUT /api/models/{id}/fields/{fieldId}（更新字段）
  - [ ] DELETE /api/models/{id}/fields/{fieldId}（删除字段）
  - [ ] POST /api/models/{id}/fields/batch-update（批量更新）
  - [ ] POST /api/models/{id}/fields/reorder（字段排序）

### 认证与权限
- [x] JWT工具封装（GenerateToken/ParseToken/RefreshToken）
- [x] Auth Service（Login/Logout/GetUserInfo/ChangePassword）
- [x] Auth Middleware（Token验证+用户信息提取+过期处理）
- [ ] Auth API Handler
  - [x] POST /api/auth/login
  - [x] POST /api/auth/logout
  - [x] GET /api/auth/profile
  - [x] POST /api/auth/refresh
  - [x] POST /api/auth/change-password
- [ ] Casbin权限集成（RBAC模型+权限验证中间件+基础策略）

---

## 验收标准

### 前端验收
- 登录功能正常
- 数据源页面可用
- 模型列表可展示
- 布局美观，响应式正常

### 后端验收
- 可完整登录认证
- 可创建数据源并测试连接
- 可从数据库表构建模型
- 所有基础API可用

### 集成验收
- 前后端接口通信正常
- 跨域配置正确
- 认证授权正常工作