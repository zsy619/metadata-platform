在用户管理系统中，用户信息通常不仅仅存储在一张表内，而是通过多个**附属表**来记录用户的各类扩展信息、行为记录和关联数据，以便于灵活扩展和维护。以下是围绕用户信息展开的常见附属表梳理，涵盖了**认证安全、个人资料、偏好设置、角色权限、社交关系、财务积分、设备位置、审核记录**等多个维度。

---

## 1. 核心用户表（`user`）
作为主表，存储用户最基本的、高频访问的字段，通常包含：
- `id`：主键
- `username`：登录名（唯一）
- `password`：加密密码
- `email`：邮箱（唯一）
- `phone`：手机号（唯一）
- `status`：状态（正常/禁用/未激活）
- `created_at` / `updated_at`
- `last_login_time`：最近登录时间
- `register_ip`：注册IP

*注：本题重点为附属表，主表仅作背景介绍。*

---

## 2. 认证与安全相关表

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_password_history` | 记录用户历史密码，用于防止重复使用旧密码 | `user_id`, `password`, `created_at` |
| `user_login_log` | 记录每次登录的详细信息，用于审计和安全分析 | `user_id`, `login_ip`, `login_time`, `user_agent`, `status`（成功/失败） |
| `user_failed_login_attempt` | 记录登录失败尝试，用于锁定策略 | `user_id`, `attempt_time`, `ip_address` |
| `user_mfa_setting` | 多因素认证配置（如TOTP、短信） | `user_id`, `method`, `secret_key`, `is_enabled` |
| `user_api_token` | 存储用户的API访问令牌 | `user_id`, `token`, `expires_at`, `scope` |
| `user_security_question` | 安全问题和答案（用于找回密码） | `user_id`, `question`, `answer_hash` |

---

## 3. 个人资料与扩展信息

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_profile` | 用户档案，存储昵称、头像、性别、生日、个人简介等（通常与主表一对一） | `user_id`, `nickname`, `avatar`, `gender`, `birthday`, `bio`, `location` |
| `user_address` | 用户地址簿（支持多个地址） | `user_id`, `receiver_name`, `phone`, `province`, `city`, `detail`, `is_default` |
| `user_contact` | 额外的联系方式（如备用邮箱、备用电话） | `user_id`, `type`（email/phone）, `value`, `is_verified` |
| `user_social_account` | 第三方账号绑定（微信、QQ、GitHub等） | `user_id`, `provider`, `open_id`, `union_id`, `profile_json` |

---

## 4. 偏好设置

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_preference` | 用户个性化配置（如主题、语言、时区、通知开关） | `user_id`, `key`, `value`（键值对形式） |
| `user_notification_setting` | 细粒度的通知渠道开关（邮件、短信、站内信） | `user_id`, `type`（如系统通知、营销）, `email_enabled`, `sms_enabled`, `in_app_enabled` |

---

## 5. 角色与权限

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_role` | 角色定义表（如果是RBAC） | `id`, `name`, `code`, `description` |
| `user_role_assignment` | 用户与角色的关联（多对多） | `user_id`, `role_id` |
| `user_permission` | 直接授予用户的权限（如果需要细粒度） | `user_id`, `permission_code` |

---

## 6. 组织与分组

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `department` | 部门/组织架构表 | `id`, `name`, `parent_id` |
| `user_department` | 用户与部门关联（多对多，可能支持兼职） | `user_id`, `department_id`, `job_title`, `is_primary` |
| `user_group` | 用户组（用于批量授权或消息推送） | `id`, `name` |
| `user_group_member` | 用户与组关联 | `user_id`, `group_id` |

---

## 7. 社交关系

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_follow` | 关注/粉丝关系 | `follower_id`, `followee_id`, `created_at` |
| `user_friend` | 好友关系（双向确认） | `user_id1`, `user_id2`, `status`, `created_at` |
| `user_blacklist` | 黑名单 | `user_id`, `blocked_user_id`, `reason` |

---

## 8. 财务与积分

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_wallet` | 用户余额账户 | `user_id`, `balance`, `frozen_balance`, `currency` |
| `user_point` | 积分账户 | `user_id`, `points`, `total_earned` |
| `user_point_transaction` | 积分流水 | `user_id`, `type`, `amount`, `balance_after`, `description` |
| `user_coupon` | 用户持有的优惠券 | `user_id`, `coupon_id`, `status`, `expires_at` |

---

## 9. 设备与位置

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_device` | 用户登录设备信息（用于设备管理、推送） | `user_id`, `device_id`, `device_type`, `push_token`, `last_active` |
| `user_login_location` | 登录地理位置记录 | `user_id`, `login_time`, `ip`, `country`, `city`, `latitude`, `longitude` |

---

## 10. 审核与状态变更

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_audit_log` | 用户信息变更审计日志 | `user_id`, `operator_id`, `action`, `old_value`, `new_value`, `created_at` |
| `user_status_history` | 用户状态变更记录（正常/禁用/注销） | `user_id`, `old_status`, `new_status`, `reason`, `changed_by`, `changed_at` |
| `user_ban_record` | 封禁记录（含解封时间） | `user_id`, `ban_reason`, `ban_until`, `unban_at`, `banned_by` |

---

## 11. 标签与营销

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_tag` | 标签定义 | `id`, `name`, `category` |
| `user_tag_assignment` | 用户与标签关联 | `user_id`, `tag_id`, `assigned_by`, `assigned_at` |
| `user_segmentation` | 用户分群（如RFM模型） | `user_id`, `segment_code`, `updated_at` |

---

## 12. 业务附属信息（示例）

| 表名 | 作用 | 关键字段 |
|------|------|----------|
| `user_membership` | 会员等级、过期时间 | `user_id`, `level`, `expires_at`, `benefits` |
| `user_invitation` | 邀请关系（谁邀请谁） | `inviter_id`, `invitee_id`, `invited_at`, `status` |
| `user_referral_code` | 用户专属邀请码 | `user_id`, `code`, `created_at` |

---

## 总结
用户管理的附属表设计应遵循以下原则：
- **垂直拆分**：将不同业务域的信息拆分到独立的表中，避免单表字段过多。
- **扩展性**：使用键值对（`user_preference`）或 JSON 字段存储频繁变动的属性。
- **审计需求**：关键操作和状态变更需要落表以便追溯。
- **性能优化**：频繁查询的字段保留在主表或使用缓存。
